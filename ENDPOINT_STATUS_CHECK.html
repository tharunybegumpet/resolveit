<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResolveIT - Endpoint Status Check</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        
        .endpoint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .endpoint-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #6366f1;
        }
        
        .endpoint-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .endpoint-url {
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            margin: 5px 0;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.testing {
            background: #fff3cd;
            color: #856404;
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç ResolveIT Endpoint Status Check</h1>
            <p>Quick verification of all API endpoints</p>
            <button class="test-button" onclick="testAllEndpoints()">üöÄ Test All Endpoints</button>
        </div>

        <div class="endpoint-grid" id="endpointGrid">
            <!-- Endpoints will be populated here -->
        </div>

        <div class="results" id="results">
            <h3>üìä Test Results Summary</h3>
            <div id="summary"></div>
        </div>
    </div>

    <script>
        const endpoints = [
            // Authentication Endpoints
            { category: 'Authentication', name: 'Login', method: 'POST', url: '/api/auth/login', requiresAuth: false },
            { category: 'Authentication', name: 'Register', method: 'POST', url: '/api/auth/register', requiresAuth: false },
            
            // Complaint Endpoints
            { category: 'Complaints', name: 'Get All Complaints', method: 'GET', url: '/api/complaints', requiresAuth: false },
            { category: 'Complaints', name: 'Create Complaint', method: 'POST', url: '/api/complaints', requiresAuth: false },
            { category: 'Complaints', name: 'Create with Files', method: 'POST', url: '/api/complaints/with-files', requiresAuth: false },
            { category: 'Complaints', name: 'Get Complaint by ID', method: 'GET', url: '/api/complaints/1', requiresAuth: false },
            { category: 'Complaints', name: 'Resolve Complaint', method: 'PUT', url: '/api/complaints/1/resolve', requiresAuth: true },
            { category: 'Complaints', name: 'Update Status', method: 'PUT', url: '/api/complaints/1/status', requiresAuth: true },
            { category: 'Complaints', name: 'Assign Staff', method: 'PUT', url: '/api/complaints/1/assign', requiresAuth: true },
            { category: 'Complaints', name: 'Get Stats', method: 'GET', url: '/api/complaints/stats', requiresAuth: false },
            { category: 'Complaints', name: 'Get Staff List', method: 'GET', url: '/api/complaints/staff', requiresAuth: false },
            { category: 'Complaints', name: 'Get Resolved', method: 'GET', url: '/api/complaints/resolved', requiresAuth: true },
            { category: 'Complaints', name: 'Get Notifications', method: 'GET', url: '/api/complaints/notifications', requiresAuth: false },
            { category: 'Complaints', name: 'Clear Notifications', method: 'POST', url: '/api/complaints/notifications/clear', requiresAuth: false },
            
            // File Upload Endpoints
            { category: 'Files', name: 'Get Files', method: 'GET', url: '/api/complaints/1/files', requiresAuth: false },
            { category: 'Files', name: 'Download File', method: 'GET', url: '/api/complaints/files/1/download', requiresAuth: false },
            { category: 'Files', name: 'Delete File', method: 'DELETE', url: '/api/complaints/files/1', requiresAuth: true },
            
            // Escalation Endpoints
            { category: 'Escalations', name: 'Create Escalation', method: 'POST', url: '/api/escalations', requiresAuth: true },
            { category: 'Escalations', name: 'Get Escalations', method: 'GET', url: '/api/escalations', requiresAuth: true },
            { category: 'Escalations', name: 'Get by ID', method: 'GET', url: '/api/escalations/1', requiresAuth: true },
            { category: 'Escalations', name: 'Update Status', method: 'PUT', url: '/api/escalations/1/status', requiresAuth: true },
            
            // Staff Application Endpoints
            { category: 'Staff Applications', name: 'Submit Application', method: 'POST', url: '/api/staff-applications', requiresAuth: true },
            { category: 'Staff Applications', name: 'Get Applications', method: 'GET', url: '/api/staff-applications', requiresAuth: true },
            { category: 'Staff Applications', name: 'Get by ID', method: 'GET', url: '/api/staff-applications/1', requiresAuth: true },
            { category: 'Staff Applications', name: 'Approve Application', method: 'PUT', url: '/api/staff-applications/1/approve', requiresAuth: true },
            { category: 'Staff Applications', name: 'Reject Application', method: 'PUT', url: '/api/staff-applications/1/reject', requiresAuth: true },
            
            // Reports Endpoints
            { category: 'Reports', name: 'Generate Report', method: 'POST', url: '/api/reports/generate', requiresAuth: true },
            { category: 'Reports', name: 'Export Report', method: 'POST', url: '/api/reports/export', requiresAuth: true },
            
            // Database Management
            { category: 'Database', name: 'Reset Database', method: 'POST', url: '/api/database/reset', requiresAuth: true },
            { category: 'Database', name: 'Get Status', method: 'GET', url: '/api/database/status', requiresAuth: true }
        ];

        function renderEndpoints() {
            const grid = document.getElementById('endpointGrid');
            const categories = [...new Set(endpoints.map(e => e.category))];
            
            categories.forEach(category => {
                const categoryEndpoints = endpoints.filter(e => e.category === category);
                const card = document.createElement('div');
                card.className = 'endpoint-card';
                card.innerHTML = `
                    <div class="endpoint-title">üìÅ ${category}</div>
                    ${categoryEndpoints.map(endpoint => `
                        <div class="endpoint-url">${endpoint.method} ${endpoint.url}</div>
                        <div class="status" id="status-${endpoint.url.replace(/[^a-zA-Z0-9]/g, '')}">‚è≥ Ready to test</div>
                    `).join('')}
                `;
                grid.appendChild(card);
            });
        }

        let authToken = null;

        async function getAuthToken() {
            if (authToken) return authToken;
            
            try {
                const response = await fetch('http://localhost:8080/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email: 'tharuny.begumpet@gmail.com', 
                        password: 'admin123' 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    console.log('‚úÖ Authentication successful');
                    return authToken;
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Authentication failed, testing without token');
            }
            return null;
        }

        async function testEndpoint(endpoint) {
            const statusId = `status-${endpoint.url.replace(/[^a-zA-Z0-9]/g, '')}`;
            const statusEl = document.getElementById(statusId);
            
            statusEl.textContent = 'üîÑ Testing...';
            statusEl.className = 'status testing';
            
            try {
                const baseUrl = 'http://localhost:8080';
                const fullUrl = baseUrl + endpoint.url;
                
                let options = {
                    method: endpoint.method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                // Add authentication if required
                if (endpoint.requiresAuth) {
                    const token = await getAuthToken();
                    if (token) {
                        options.headers['Authorization'] = `Bearer ${token}`;
                    }
                }
                
                // Add sample data for POST/PUT requests
                if (endpoint.method === 'POST' || endpoint.method === 'PUT') {
                    if (endpoint.url.includes('/login')) {
                        options.body = JSON.stringify({ 
                            email: 'admin@resolveit.com', 
                            password: 'admin123' 
                        });
                    } else if (endpoint.url.includes('/register')) {
                        options.body = JSON.stringify({ 
                            fullName: 'Test User',
                            email: 'test@test.com', 
                            password: 'test123',
                            role: 'USER'
                        });
                    } else if (endpoint.url.includes('/complaints') && !endpoint.url.includes('/')) {
                        options.body = JSON.stringify({ 
                            title: 'Test Complaint', 
                            description: 'Test Description', 
                            category: 'Technical Issues',
                            anonymous: false
                        });
                    } else if (endpoint.url.includes('/status')) {
                        options.body = JSON.stringify({ status: 'IN_PROGRESS' });
                    } else if (endpoint.url.includes('/assign')) {
                        options.body = JSON.stringify({ staffId: 1 });
                    } else if (endpoint.url.includes('/escalations')) {
                        options.body = JSON.stringify({ 
                            complaintId: 1,
                            reason: 'Test escalation',
                            priority: 'HIGH'
                        });
                    } else if (endpoint.url.includes('/staff-applications')) {
                        if (endpoint.url.includes('/approve') || endpoint.url.includes('/reject')) {
                            options.body = JSON.stringify({ reason: 'Test decision' });
                        } else {
                            options.body = JSON.stringify({ 
                                fullName: 'Test Staff',
                                email: 'staff@test.com',
                                experience: 'Test experience',
                                motivation: 'Test motivation'
                            });
                        }
                    } else if (endpoint.url.includes('/reports')) {
                        options.body = JSON.stringify({
                            startDate: '2024-01-01',
                            endDate: '2024-12-31',
                            categories: ['Technical Issues', 'Maintenance']
                        });
                    } else {
                        options.body = JSON.stringify({});
                    }
                }
                
                const response = await fetch(fullUrl, options);
                
                if (response.ok || response.status === 401 || response.status === 403) {
                    // 401/403 means endpoint exists but needs auth - that's OK
                    let statusText = `‚úÖ ${response.status}`;
                    if (response.status === 401) statusText += ' (Auth Required)';
                    if (response.status === 403) statusText += ' (Forbidden)';
                    if (response.status === 200) statusText += ' (Success)';
                    
                    statusEl.textContent = statusText;
                    statusEl.className = 'status success';
                    return true;
                } else if (response.status === 404) {
                    statusEl.textContent = `‚ùå 404 - Endpoint Not Found`;
                    statusEl.className = 'status error';
                    return false;
                } else if (response.status === 500) {
                    statusEl.textContent = `‚ö†Ô∏è 500 - Server Error`;
                    statusEl.className = 'status error';
                    return false;
                } else {
                    statusEl.textContent = `‚ö†Ô∏è ${response.status} - ${response.statusText}`;
                    statusEl.className = 'status error';
                    return false;
                }
            } catch (error) {
                statusEl.textContent = `‚ùå Connection Error`;
                statusEl.className = 'status error';
                return false;
            }
        }

        async function testAllEndpoints() {
            const results = document.getElementById('results');
            const summary = document.getElementById('summary');
            
            results.style.display = 'block';
            summary.innerHTML = '<p>üîÑ Testing in progress...</p>';
            
            // First test basic connectivity
            summary.innerHTML = '<p>üîÑ Testing backend connectivity...</p>';
            try {
                const connectTest = await fetch('http://localhost:8080/api/complaints/stats');
                if (!connectTest.ok && connectTest.status !== 401) {
                    throw new Error('Backend not responding');
                }
                summary.innerHTML = '<p>‚úÖ Backend connected! Testing endpoints...</p>';
            } catch (error) {
                summary.innerHTML = `
                    <div style="padding: 15px; background: #f8d7da; border-radius: 8px; color: #721c24;">
                        <strong>‚ùå Backend Connection Failed</strong><br>
                        Make sure the backend is running on http://localhost:8080<br>
                        Error: ${error.message}
                    </div>
                `;
                return;
            }
            
            let successCount = 0;
            let totalCount = endpoints.length;
            
            // Test endpoints in batches to avoid overwhelming the server
            for (let i = 0; i < endpoints.length; i += 3) {
                const batch = endpoints.slice(i, i + 3);
                const batchResults = await Promise.all(batch.map(testEndpoint));
                successCount += batchResults.filter(result => result).length;
                
                // Small delay between batches
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            const successRate = Math.round((successCount / totalCount) * 100);
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                    <div>
                        <div style="font-size: 2em; color: #28a745;">${successCount}</div>
                        <div>Successful</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; color: #dc3545;">${totalCount - successCount}</div>
                        <div>Failed</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; color: #6366f1;">${successRate}%</div>
                        <div>Success Rate</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: ${successRate >= 80 ? '#d4edda' : '#f8d7da'}; border-radius: 8px;">
                    <strong>${successRate >= 80 ? 'üéâ System Status: HEALTHY' : '‚ö†Ô∏è System Status: NEEDS ATTENTION'}</strong>
                    <br>
                    ${successRate >= 80 ? 'Most endpoints are working correctly!' : 'Some endpoints may need attention.'}
                </div>
            `;
        }

        // Initialize the page
        renderEndpoints();
    </script>
</body>
</html>